{
  "entities": {
    "Staff": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Staff",
      "type": "object",
      "description": "Represents an employee of the company.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Staff entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the staff member."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the staff member."
        },
        "hourlyRate": {
          "type": "number",
          "description": "The fixed hourly rate for the staff member."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "The date of birth of the staff member.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "hourlyRate",
        "dateOfBirth"
      ]
    },
    "AttendanceRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AttendanceRecord",
      "type": "object",
      "description": "Represents a single attendance record for a staff member.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AttendanceRecord entity."
        },
        "staffId": {
          "type": "string",
          "description": "Reference to Staff. (Relationship: Staff 1:N AttendanceRecord)"
        },
        "checkInTime": {
          "type": "string",
          "description": "The date and time when the staff member checked in.",
          "format": "date-time"
        },
        "checkOutTime": {
          "type": "string",
          "description": "The date and time when the staff member checked out.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "staffId",
        "checkInTime",
        "checkOutTime"
      ]
    },
    "AdvancePayment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdvancePayment",
      "type": "object",
      "description": "Represents an advance payment made to a staff member.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AdvancePayment entity."
        },
        "staffId": {
          "type": "string",
          "description": "Reference to Staff. (Relationship: Staff 1:N AdvancePayment)"
        },
        "paymentDate": {
          "type": "string",
          "description": "The date when the advance payment was made.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the advance payment."
        }
      },
      "required": [
        "id",
        "staffId",
        "paymentDate",
        "amount"
      ]
    },
    "Salary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Salary",
      "type": "object",
      "description": "Represents the calculated salary for a staff member for a specific period.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Salary entity."
        },
        "staffId": {
          "type": "string",
          "description": "Reference to Staff. (Relationship: Staff 1:N Salary)"
        },
        "periodStartDate": {
          "type": "string",
          "description": "The start date of the salary period.",
          "format": "date-time"
        },
        "periodEndDate": {
          "type": "string",
          "description": "The end date of the salary period.",
          "format": "date-time"
        },
        "totalWorkingHours": {
          "type": "number",
          "description": "The total number of working hours during the period."
        },
        "salaryAmount": {
          "type": "number",
          "description": "The calculated salary amount for the period."
        },
        "totalAdvance": {
          "type": "number",
          "description": "The total advance payment received during the period."
        },
        "balance": {
          "type": "number",
          "description": "The remaining balance after deducting advance payments from the salary."
        }
      },
      "required": [
        "id",
        "staffId",
        "periodStartDate",
        "periodEndDate",
        "totalWorkingHours",
        "salaryAmount",
        "totalAdvance",
        "balance"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/staff/{staffId}",
        "definition": {
          "entityName": "Staff",
          "schema": {
            "$ref": "#/backend/entities/Staff"
          },
          "description": "Stores staff member details. 'staffId' is the document ID and ownerId.",
          "params": [
            {
              "name": "staffId",
              "description": "Unique identifier for the staff member."
            }
          ]
        }
      },
      {
        "path": "/staff/{staffId}/attendance_records/{attendanceRecordId}",
        "definition": {
          "entityName": "AttendanceRecord",
          "schema": {
            "$ref": "#/backend/entities/AttendanceRecord"
          },
          "description": "Stores attendance records for a staff member.  Path-based ownership using 'staffId'.",
          "params": [
            {
              "name": "staffId",
              "description": "Unique identifier for the staff member."
            },
            {
              "name": "attendanceRecordId",
              "description": "Unique identifier for the attendance record."
            }
          ]
        }
      },
      {
        "path": "/staff/{staffId}/advance_payments/{advancePaymentId}",
        "definition": {
          "entityName": "AdvancePayment",
          "schema": {
            "$ref": "#/backend/entities/AdvancePayment"
          },
          "description": "Stores advance payments for a staff member. Path-based ownership using 'staffId'.",
          "params": [
            {
              "name": "staffId",
              "description": "Unique identifier for the staff member."
            },
            {
              "name": "advancePaymentId",
              "description": "Unique identifier for the advance payment."
            }
          ]
        }
      },
      {
        "path": "/staff/{staffId}/salaries/{salaryId}",
        "definition": {
          "entityName": "Salary",
          "schema": {
            "$ref": "#/backend/entities/Salary"
          },
          "description": "Stores salary information for a staff member. Path-based ownership using 'staffId'.",
          "params": [
            {
              "name": "staffId",
              "description": "Unique identifier for the staff member."
            },
            {
              "name": "salaryId",
              "description": "Unique identifier for the salary record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to manage staff attendance, advance payments, and salary calculations for the TimeTrack Pro application. It prioritizes authorization independence and clear security rules.  The core strategy revolves around path-based ownership for staff-related data and segregation of staff data from admin-specific configurations.\n\n*   `/staff/{staffId}`: Stores individual staff member details. The `staffId` serves as the document ID and the owner ID.\n*   `/staff/{staffId}/attendance_records/{attendanceRecordId}`:  Stores attendance records for each staff member. This subcollection enforces path-based ownership, ensuring only the system (or potentially the staff member themselves with appropriate roles) can modify these records.\n*   `/staff/{staffId}/advance_payments/{advancePaymentId}`: Stores advance payment records for each staff member, similar to attendance records, enforcing path-based ownership.\n*   `/staff/{staffId}/salaries/{salaryId}`: Stores salary records for each staff member, following the same ownership pattern.\n\n**Authorization Independence:** Each subcollection (`attendance_records`, `advance_payments`, `salaries`) relies on the `staffId` in the path for authorization. This eliminates the need for `get()` calls to parent documents, enabling atomic operations and simplifying security rules.\n\n**QAPs (Rules are not Filters):**  The structure inherently supports secure `list` operations. Listing attendance records, advance payments, or salaries is scoped to a specific staff member via the `/staff/{staffId}` path, preventing unauthorized access to other staff members' data. Segregation of staff data by `staffId` is core here. The addition of admin roles will allow admin user to `list` all the records."
  }
}