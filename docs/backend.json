{
  "entities": {
    "Staff": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Staff",
      "type": "object",
      "description": "Represents an employee of the company.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the staff member."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the staff member."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the staff member."
        },
        "hourlyRate": {
          "type": "number",
          "description": "The staff member's fixed salary per hour."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "hourlyRate"
      ]
    },
    "AttendanceRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AttendanceRecord",
      "type": "object",
      "description": "Represents a single attendance record for a staff member.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the attendance record."
        },
        "staffId": {
          "type": "string",
          "description": "Reference to Staff. (Relationship: Staff 1:N AttendanceRecord)"
        },
        "date": {
          "type": "string",
          "description": "The date of the attendance record.",
          "format": "date-time"
        },
        "timeIn": {
          "type": "string",
          "description": "The time the staff member checked in.",
          "format": "date-time"
        },
        "timeOut": {
          "type": "string",
          "description": "The time the staff member checked out.",
          "format": "date-time"
        },
        "timeIn2": {
          "type": "string",
          "description": "The time the staff member checked in for the second shift.",
          "format": "date-time"
        },
        "timeOut2": {
          "type": "string",
          "description": "The time the staff member checked out for the second shift.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "staffId",
        "date"
      ]
    },
    "AdvancePayment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdvancePayment",
      "type": "object",
      "description": "Represents an advance payment made to a staff member.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the advance payment."
        },
        "staffId": {
          "type": "string",
          "description": "Reference to Staff. (Relationship: Staff 1:N AdvancePayment)"
        },
        "date": {
          "type": "string",
          "description": "The date the advance payment was made.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount of the advance payment."
        }
      },
      "required": [
        "id",
        "staffId",
        "date",
        "amount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/staff/{staffId}",
        "definition": {
          "entityName": "Staff",
          "schema": {
            "$ref": "#/backend/entities/Staff"
          },
          "description": "Stores staff profiles. Only admins can create, read, update, and delete staff profiles.",
          "params": [
            {
              "name": "staffId",
              "description": "The unique identifier of the staff member."
            }
          ]
        }
      },
      {
        "path": "/staff/{staffId}/attendanceRecords/{recordId}",
        "definition": {
          "entityName": "AttendanceRecord",
          "schema": {
            "$ref": "#/backend/entities/AttendanceRecord"
          },
          "description": "Stores attendance records for a specific staff member. Only admins can create, read, update, and delete attendance records.",
          "params": [
            {
              "name": "staffId",
              "description": "The unique identifier of the staff member."
            },
            {
              "name": "recordId",
              "description": "The unique identifier of the attendance record."
            }
          ]
        }
      },
      {
        "path": "/staff/{staffId}/advancePayments/{paymentId}",
        "definition": {
          "entityName": "AdvancePayment",
          "schema": {
            "$ref": "#/backend/entities/AdvancePayment"
          },
          "description": "Stores advance payments for a specific staff member. Only admins can create, read, update, and delete advance payments.",
          "params": [
            {
              "name": "staffId",
              "description": "The unique identifier of the staff member."
            },
            {
              "name": "paymentId",
              "description": "The unique identifier of the advance payment."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "adminRole",
          "schema": {
            "$ref": "#/backend/entities/Staff"
          },
          "description": "Marks a user as an administrator. The existence of a document at this path grants admin privileges.",
          "params": [
            {
              "name": "uid",
              "description": "The Firebase Auth UID of the administrator."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the TimeTrack Pro application, focusing on attendance tracking, advance payments, and staff management. It follows the principles of Authorization Independence, Structural Segregation, and Access Modeling to ensure security and scalability.\n\n1.  **Authorization Independence:** The structure uses path-based ownership for staff-related data (attendance records, advance payments). Each staff member's data is stored under their respective `/staff/{staffId}` document, eliminating the need for `get()` calls in security rules to verify ownership.  The system is designed with the assumption that only admins will have the ability to create, read, update and delete these documents.\n2.  **Structural Segregation:** The `staff` collection stores staff profiles. Attendance records and advance payments are stored in subcollections under each staff document, maintaining a clear separation of data with similar access control requirements.\n3.  **Access Modeling:** Path-based ownership (`/staff/{staffId}/attendanceRecords/{recordId}`, `/staff/{staffId}/advancePayments/{paymentId}`) is used to manage the 1:N relationships between staff and their attendance records/advance payments. This simplifies security rules, allowing easy restriction of access to a staff member's own data. The admin role is managed via the presence of a document in `/roles_admin/{uid}`.  This avoids custom claims.\n\nThis structure facilitates simple, robust, and easily debuggable security rules, aligning with the core design principles."
  }
}
